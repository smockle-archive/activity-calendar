language: node_js
node_js:
- '8'
notifications:
  email:
    on_success: change
    on_failure: always
before_install:
- npm install -g greenkeeper-lockfile@1
- pip install --user awscli
- pip install --user aws-sam-cli
before_script:
- greenkeeper-lockfile-update
script:
- npm test
- sam validate
after_script:
- greenkeeper-lockfile-upload
- codecov
env:
  global:
  - secure: fN1n6kFC4RfPg/ts1hT4rI3shRQighWRQUw7cb2/Sf5T4despLTepDhaPfK1sJ6EJ1Fw8CPSP33MWweXMz66APcsUkSarGZC8oKTk0yoWyUAouUiRfp0dIHROKSwvR3REMhkXohqG2TOqb6Ef7Y41SYreFTuiJRnefdhShxqe7YLr1LhHo6S6H6noqVUvBt/dGmXv3ODudPwn4aRQfN2w30NXfaFizKMxZsG01wWc8grn+Sb2FzAQ1IyHzVFcOQYcagXCoaeOa86K5B2g+sxh1ZVM5H2CszUrZUFolgLT5BaWOE+z8zJCshPBKh7oUItWcmmri/SWnjqBEgS8Bv/y8Woj/6TJOC63c49ikbAtg5qXEdXl9ltBlSj1ktr/SL9HGDk1Ge3WJq1cb9vqqOqyU4nHcyqbrky+1LQVoJ7CFz2Rle4BIesJKZNBRwbxQmDbryshcrxMmDZuxNmjwhwQZ6axUFoqBmTan6+5Fo3BdzEO0sCJJFSyS4hh+PrU41dskfsEDvTYWkzPxwc9OyIICcJpUo65o7aAm9gGeKzidSMZ1kdNNj1IVL25gTM3xzPXDOQrRk4LBX8FpEojYiGMW0zRCZYkPTnl3/zIEUGb/c0dXE+JJuEZMoRIeYTwZm4FSpP0/WM8FF9o1o81Mi/vI2fmDx45Zu6HeitDSO2wO0=
  - secure: aQ5Do6YFuXB7Petm0iXSceL1CJ6fWIuF7fqfh+6wI1Bk4q6dbs0g1Kvxl5B04+9fHVi/L9HYXf8Sj6n+7XeP12inxKJrfDWLJnucJlbz7iT22/ajgTs8iaB3m09Va6a3FvipzdxLhS8lA4R3YPrQJ63ZP8MGgknpsEFlGcx9agrAvpaThSfn9iTK1xFRtnDoIEC6Vdd4xoRMTZI9NjPoTIwrfWHS249E/E3v8fnDigq0nNN8XOJij4gjAWCZh4Md+i4v+FKs2+OvBR+J0sVw8KUmy3h7lMdLIwkfIWgRFY2dREz/XcEgTmmYCpVPOor3FL4MdFN5pVxys7y/FbahMaKEYtYiD3HFvnyHSmAK0j9WD8FLC7EcAYPMyTAhEuBXudk+LX4XN3IjLUgnmBjmcXxs7t3toZ6VGTRSS7PnocGrbrDLYHt8xPG/TjoyCv99xjqLOfA0VjjC+RbtLWNv5qXWfDEsRktPTXn7yT3eelhUoaJULL0aZP3oxkDhHJYgK3PpTbYIjmgcvEo++HKnSXP9uwOKU3SZLaUz7k3YSrxSN2GeUFz9GoUr7jEeWlBbZO2Jv6PLQRpV/G5mItvzyikfDG4TNG6MkTkhMExSeM+uZy3GTwi4PXTl+FyglZsugiMgXlWz2BsJHTI/XNam+WeywUAQ+RtBMRJ88qIsJmU=
  - secure: lxGCB84qmmxj38vuBHoqOvvJuJugVZ7kpDCOv76FeLZVRWyZcS+ESrx9N5xmuUBAuJ1lgDyUwGmMhMTh8B1teCtaZAJW3NJSGOiip/u9vHEWiTOd2xB98gYz895FuYRZWeMgaHjmF8iCTgv6Nea18DMRhwOxP1RDNQKR4A2jfZtDGeZmbZB624cqAG1bkTBqBcqyApWDUsyZafA20nnUu4TyNyHugvf54AQVIrRtxZf6c0kevcpKlGI/+Sd7C8EJRqOHRlLVXvHxh7Ot/4woI3iLQVr8bTLDfMB7zI5X9+MOc3khKPGccEq1b/Jnpk8e/v4+Eo/iOtlP+Pc2cAnQlBRJecR3gsLQmdwei0s16nu79uKx8sbsqDBtKxh9v6dg06TPskfhE7JpDlMMHK6QETBsdarG1xeAu32EDNzzXzR0XYuuxu9VTakgoTRf0icE/nhXRwlQadtAzng+A7g1Ms9rlC4n2ZXR5LKXOKbFhCGKwYsvY3Z6xMc7gvQbv5j3RBblzheyDiANcN2lSWIo1QRUp5MWa7Qd7XmLqybNdIHLkplwcs8Pt+jh5Fu3xtWWUnJNLJRRQhRCHa/VPVPn75RDuKCX4z76PTetl3j9N+dChhNhHH/plC1YSCayVNtFeZccSOPh9v94fKm8YNGO3XLwJ0AUGW04mcAIXV3jPG4=
  - secure: nnvOB0BvV+8Sln4MjPjF3LoUFLDeAjOGVEpRbGe8Zka9cS4Mzt/waNmsZFB+h+Fd1fn0TdkxpGt7V+kc1qF/czDYUO3TAGmYHOoQHHBNoPW/se2NO+ZUINfQY9vMLYShrlolMRDTc6SHKO2MgpohKEIqByGPy45AjyQk2anBbxAvPBHzbF/aEk44bok/N/amTJgMy33d6PfpffQ3uKCXvXdmB7t2L6kpWn1mDW6qXtE/sz0dalrpgrT6kWm9/cL0femciNwdSd09UQq9o7hwlCH/mlMKugHSDLqmiMSQX9CK6n/K2gQv1vozMHR0sJWEaptrS0xEyi0uNJe77xmuubHHOzF+3Sn8pZF3bPoUo0GEniIOp52tOVflTJnuC424URppFN2mPiaMP3I/UFmgQ6LOqZ7y4CUNhflryPx8r6KIHnmZAPH4c3U5SxGszhDCcc3+PXesrN+1Am0cIYT2Q3U7+yj0lXahkupC5WBFOfbjNc+za0Kvaw24WgNW8nCBcpPNghbYgplr42NbGAD+fWuF82hhmohKKuYZXfmAem2YJG0ghqViBh2hZtZS2BUjObLI8MSPQhrCUHvW3rAXYVOWKsGc9veCfHZzRzzDLqaP4WFTuP9GkEr8/pqaAMd+3/R7Ppf7MMr/o8mr7KeOIYrA4ESpKHhXlZKnYyAhPpA=
  - secure: NHbHWDOQmT63ST09AksmB8vL2P5EQfokFRjxGOkgqN5pqM7dw5CDw8y1/NStYqF5h7G6r43Wq6c+VQEB7DJswChTkfecDrM2WmIGGfaCpPy6yF/dLFNJQWenEgjeSSQQhAgf3ebXMSXBMmbjIJmmxV67gVbpzAyPxaWalyOM3/7wk2RPQWywXiUa6ALl2k4b95IVZzUtqmireoZnodxqgJhoR2wgiytWMTDN8EcItzNap+czifJmvft1yskEdUcD8/JGXNMN1UhPOcx2EzJerN6tegdN99xvvWyFsjmmBuUWI7LCK0vVbZmQJyRngp07f5Us6bz6nSYZZBGdzGyRQBzVz2lg0es55/paVONpPiDOlpZC/DB56/iOtl8UnDo5yKOjeLv7fr43EDUOws9AtR92pkgolYibHUDDdDEERptK4NHIFtYrGA1eiaN46r7WTo+trId6U9osRI/5jf8cBn4HM4rEXsqVpRi/HgfaXDACWNSTm43WnvvfS5DBEnNAYcgh65fHi3RLZTZjF+mlQRpATsaAOaLNUvumA9qGamPQSYrZGdFFgA9Un8FTLyEWUssAIgCYj664Z3MRl3+96uSDPskup8wbg0CnQ6mKoez686PTPx5kLqMm8ttTDLPzeaLsOcnHfyDeJhFAtHFAN+23RYX7u5FHOWXIzzOOFJI=
  - secure: DrSVRI+f4m+mEo5skBEfRxBS1PYDzSWBW8tx20UF/2bQTq1XXGgkx7dvkLcsenoBEzQDCt34SVCAQ5BTJBA6wgjBkhZxksG/y/UbsQu8fyb+oeXcTr5A2IcdeNmMfGqJTyPLzixQrzF0wwRncMpKpw/QZwVD8RHdifjf94awSTCGLu2qy1ZKrr5ve30YMkPdc5V/c62pfazv7gjt44ofREzsNFmwZkenmyFbpcaNeW2p6rdkKLlpd5vcQK9UvFoUZwDlYe/d56151Gr1HPLZaQfss6w12cgeGb39L+drueADax0yhPe+UjVB7MIK4MRshlCXdweImQE6bxWiNCIj3D10zOwbVUdatGBc09i5UDXwYxrlYDyL3VimfY3k2r6dOaulPbhWkk4bLjI9buLRHRS2hV4J4FlH+ucCC1cGdIEB0q4OmPasuXrhoO1Dcj3gaNJNqsKSZjxBJlH7WtqAg0gS5knd54w0ds5MDgGWXoN/cQhWX4TpwePk0NlX/P/S7MoN1N50E+AIis0c5pXULyM7fSJJX63td83kp6MANqI9R6GRGVtwGnUysYOYS+xblNQxYw6NMpPmM5ynLeXgPRotVCsUXhH1LloU/18gxcqqkgI3U4n2cft/9ZjWtuV/O0p9d8OS8wdpJXfXAjMvIhVIAS086CKGR43k9kXHHac=
  - secure: MbtGIkUP2u29KQFEjfiFtp5Lin5qvvzTA8uh39GCGR6WY7H7e8cp1dUulUKE/3iuaLAVNeS0L9fWOWnQEHO+PV1HgCwjqtkng2MYkfye5QT8WyjQTKirLTZ0hLybuyECm6uDMc5B41qqVhUq1zxiJ2j+BMLeF0W016D+LRjUkr70MmnTld46lNE58x8VtWifOaFrnzcgdKPhaIfXnOeDN98fynVE8Y+KC/OpPv05R/WZ/d/GYQuBxSJMEJ/Ue6TIww1wJY+wZYbSVs7bFQcxhm1zXRryddb2FK0W13eP9yZlTmvTQc8cTdOsiHgFJaNEkjByWOURuMccoU8MFD0JKCX0PlgIGRizf01+WMFxon8lABoaWPoE3LN2LV9IP4lHJ3iKyZx9vWE22G7b2Zau7kwbLk3ZF2S2Bkihsa+WrODyUh5EqspZduJ56h9vLXUV/WD1gDF5J8nug657jH1wvgTfirmFm34oLyYMwh5I7cbZRWo3IWmQPHeUY+uZNWgC43MqKBzGS0GA4uP9SlVMbngGZFUY3FJa4JQHTZ48nUi8u0252NHXraByxxViJYswoebEm5tAXI+iYDlBnNIINSqstzVJl0vhOGDDkFH03vVukharUobg0xaBTYr7h39ZYcB0uQdptfMlIv/FnkBKdFakuFY1uR1c15kTitrxRqU=
deploy:
  provider: script
  script: sam package --template-file template.yaml --s3-bucket "$AWS_S3_BUCKET_NAME" --output-template-file packaged.yaml && sam deploy --template-file packaged.yaml --parameter-overrides IFTTT_EVENT="$IFTTT_EVENT" IFTTT_KEY="$IFTTT_KEY" --stack-name activity-calendar
  skip_cleanup: true
  on:
    branch: master
